# プロダクト要求定義書 (Product Requirements Document)

## プロダクト概要

### 名称
**AI Curated Newsletter** - 技術情報のノイズレス・キュレーション通知システム

### プロダクトコンセプト
- **出力最小主義**: 収集は広く、出力は厳選。通知が少ないことが価値である
- **LLM判断器**: LLMは判定のみに使用し、件数制御・重複排除・Buzz定量は非LLMロジックで処理
- **判断コストゼロ**: ユーザーは「読む価値があるか？」の判断をせず、通知された記事だけ読めばよい

### プロダクトビジョン
技術ニュース・テックブログ・話題記事を広範囲に収集し、ユーザーの関心に照らして「本当に読む価値がある」ものだけを抽出する。
情報量ではなく、判断コストの削減・ノイズの排除・最小出力の維持こそが価値である。
週2〜3回・各回最大12件に厳選して通知することで、情報過多から解放され、質の高い技術情報にのみ集中できる世界を実現する。

### 目的
- 技術情報の判断コストをゼロにする（「読むべきか？」の判断をシステムが代行）
- ノイズを徹底的に排除する（無関係な情報・重複・低品質記事を通知しない）
- 最小出力を維持する（各回最大12件、0件でも通知）
- ユーザーの関心に合致する高品質な記事のみを届ける

## ターゲットユーザー

### プライマリーペルソナ: 佐藤太郎（34歳、シニアバックエンドエンジニア / テックリード）
- **役割**: Web系スタートアップでバックエンド全般を担当。設計・スケーラビリティ・運用に責任を持つ
- **技術スタック**: Kotlin/Ktor, TypeScript, PostgreSQL, AWS（Lambda/ECS/Aurora）, DDD/クリーンアーキテクチャ
- **現在の課題**:
  - 技術ブログ、HackerNews、Reddit、各種RSSなど収集元が多く、毎日追うのは非現実的
  - タイトルだけでは「読む価値があるか？」判断できず、本文確認が必要で時間がかかる
  - 同じトピックの記事が複数ソースで流れてきて、既読判定が面倒
  - 情報を追う時間を増やしたくないが、重要な記事は見逃したくない
- **期待する解決策**:
  - 自分の関心に合った記事だけが自動的に厳選されて届く
  - 週2〜3回のまとめで十分（リアルタイム不要）
  - 通知件数は少なくてよい（質 > 量）
  - ノイズがないことが最重要
- **1日の典型的なワークフロー**:
  - 午前: コードレビュー、設計ミーティング、実装
  - 午後: 実装、障害対応、パフォーマンス改善
  - 隙間時間: 技術記事をざっと確認（5〜10分程度）
  - 夜: 重要な記事だけじっくり読む（30分程度）

## 成功指標(KPI)

### プライマリーKPI
- **通知記事の精度（関心度合い）**: 通知された記事のうち80%以上が「読む価値があった」と評価される（フィードバック機能で測定、Phase 2）
- **各回の平均通知件数**: 6〜12件（理想は8〜10件）を維持
- **ノイズ率**: 通知された記事のうち「無関係/低品質」と評価される割合が10%以下（Phase 2のフィードバック機能で測定）

### セカンダリーKPI
- **実行成功率**: 95%以上（週2〜3回の実行で失敗しない）
- **LLMコスト**: 1回あたり$0.50以下（週2回実行で月$4以下）
- **重複排除率**: 同一URL再通知ゼロ（キャッシュによる完全排除）

## 収集元マスタ

### 管理方針
- 収集元は**マスタ**として管理し、アプリケーションコードとは分離する
- 追加・削除は**マスタの変更のみ**で完結させる（コード改修不要）
- RSS/AtomフィードのURL、名称、優先度などを設定ファイルまたはDynamoDBで定義
- 各ソースの収集頻度、タイムアウト、リトライ設定を個別に管理可能

### MVP対象の収集元リスト

以下は初期実装で対象とする情報源：

| カテゴリ | 収集元 | 備考 |
|---------|--------|------|
| **総合ニュース** | Hacker News | https://news.ycombinator.com/rss |
| **日本語ブックマーク** | はてなブックマーク | テクノロジーカテゴリ |
| **日本語技術記事** | Zenn | トレンドフィード |
| **日本語技術記事** | Qiita | トレンドフィード |
| **クラウド** | AWS Blog | 公式ブログ（英語） |
| **データベース** | PostgreSQL系ブログ | Planet PostgreSQL等 |
| **企業エンジニアリングブログ** | Uber Engineering Blog | https://www.uber.com/blog/engineering/ |
| **企業エンジニアリングブログ** | Airbnb Engineering Blog | https://medium.com/airbnb-engineering |
| **企業エンジニアリングブログ** | GitHub Engineering Blog | https://github.blog/engineering/ |
| **企業エンジニアリングブログ** | 日本企業ブログ | Mercari, CyberAgent等 |
| **コミュニティ** | Reddit | r/programming, r/webdev, r/aws等 |
| **AI/LLM** | AI系ブログ | OpenAI Blog, Anthropic Blog, Google AI Blog等 |

### 将来拡張候補（Phase 2以降）

- **X（旧Twitter）**: 特定ハッシュタグ・リスト
- **Dev.to**: 技術記事プラットフォーム
- **Medium publications**: 技術系出版物
- **技術カンファレンス動画**: YouTube（AWS re:Invent等）
- **GitHub Trending**: 人気リポジトリ情報
- **Product Hunt**: 新技術プロダクト

### マスタ管理の技術仕様

**Phase 1（MVP）**:
- 設定ファイル（JSON/YAML）で管理
- Lambda環境変数で設定ファイルのパスを指定
- 各ソースには以下の属性を定義:
  ```json
  {
    "source_id": "hacker_news",
    "name": "Hacker News",
    "feed_url": "https://news.ycombinator.com/rss",
    "feed_type": "rss",
    "priority": "high",
    "timeout_seconds": 10,
    "retry_count": 2,
    "enabled": true
  }
  ```

**Phase 2（拡張）**:
- DynamoDB管理に移行（動的な追加・削除が可能）
- 管理UIまたはCLIで収集元を追加・編集
- 各ソースの収集統計（成功率、平均記事数）を記録

## 機能要件

### コア機能(MVP - Phase 1)

#### 1. RSS/Atom収集

**ユーザーストーリー**:
システム管理者として、技術ブログ・ニュースサイトのRSS/Atomフィードから記事情報を自動収集したい

**受け入れ条件**:
- [ ] 複数のRSSフィードから記事情報（URL、タイトル、公開日時、ソース名、概要）を取得できる
- [ ] 取得情報は最大800文字の概要のみで、本文全文は取得しない
- [ ] 1つのソース失敗で全体が停止せず、他のソースは収集を継続する
- [ ] 収集件数を構造化ログに記録する

**優先度**: P0(必須)

**技術仕様**:
- フィード一覧は「収集元マスタ」（設定ファイルまたはDynamoDB）で管理
- 各ソースの設定（URL、タイムアウト、リトライ回数）は個別に定義可能
- タイムアウト設定: 各フィードあたり10秒（デフォルト、ソース毎に調整可能）
- エラーハンドリング: ソース単位でリトライ（最大2回）、失敗時はログ記録して継続
- 収集元マスタの詳細は「収集元マスタ」セクションを参照

#### 2. 正規化

**ユーザーストーリー**:
システムとして、収集した記事情報を統一フォーマットに正規化し、後続処理を簡素化したい

**受け入れ条件**:
- [ ] URL正規化（クエリパラメータ除去、utm_*除去、スキーム統一）ができる
- [ ] 日時をUTC ISO8601形式に統一できる
- [ ] タイトルを整形（前後空白除去、HTML実体参照デコード）できる
- [ ] 概要を最大800文字に制限できる

**優先度**: P0(必須)

#### 3. 重複排除

**ユーザーストーリー**:
ユーザーとして、同じ記事を複数回通知されたくない

**受け入れ条件**:
- [ ] 正規化されたURL単位で重複を検出できる
- [ ] DynamoDBキャッシュに存在するURLは再判定しない
- [ ] MVP段階では完全一致のみ（近似重複は未対応）

**優先度**: P0(必須)

#### 4. Buzz定量（非LLM）

**ユーザーストーリー**:
システムとして、記事の話題性（Buzz）を定量化し、LLM判定対象の優先順位付けに使用したい

**受け入れ条件**:
- [ ] 複数ソースでの出現回数をカウントできる（同一URLが複数フィードに登場）
- [ ] 公開からの経過日数を計算できる（鮮度スコア）
- [ ] ドメイン多様性を計算できる（同一ドメインの記事数）
- [ ] 上記を組み合わせたBuzzスコアを算出できる

**優先度**: P0(必須)

**技術仕様**:
- Buzzスコア計算式（例）: `score = (source_count * 10) + (100 - days_old * 5) + (domain_diversity * 5)`
- スコアが高いほど優先度高

#### 5. LLM投入選定

**ユーザーストーリー**:
システムとして、LLMコストを抑えるために判定対象を絞り込みたい

**受け入れ条件**:
- [ ] Buzzスコア + 鮮度でソートできる
- [ ] 上位最大150件（推奨120件）を選定できる
- [ ] キャッシュヒット済みURLは再判定対象から除外できる
- [ ] 選定件数をログに記録できる

**優先度**: P0(必須)

#### 6. LLM判定（Interest/Buzz）

**ユーザーストーリー**:
システムとして、記事がユーザーの関心に合致するかをLLMで判定したい

**受け入れ条件**:
- [ ] 関心プロファイル（Interest Profile）を元に判定できる
- [ ] 判定結果は固定フォーマット（JSON）で取得できる: `{"interest_label": "ACT_NOW | THINK | FYI | IGNORE", "buzz_label": "HIGH | MID | LOW", "confidence": 0.0~1.0, "reason": "..."}`
- [ ] 判定プロンプトには以下を含める:
  - 関心プロファイル（強い関心・低優先度のリスト）
  - 記事情報（タイトル、概要、ソース名、公開日時）
  - 判定基準（ACT_NOW: 今すぐ読むべき / THINK: 設計判断に役立つ / FYI: 知っておくとよい / IGNORE: 関心外）
- [ ] JSON形式崩れの場合、再試行（最大2回）→ 失敗時はIGNORE扱い
- [ ] 判定結果をDynamoDBにキャッシュできる

**優先度**: P0(必須)

**技術仕様**:
- LLM: AWS Bedrock（Claude 3.5 Sonnet）
- タイムアウト: 30秒/リクエスト
- バッチ処理: 並列度5（同時に5件判定）

#### 7. 最終選定

**ユーザーストーリー**:
ユーザーとして、週2〜3回・各回最大12件に厳選された記事のみを通知されたい

**受け入れ条件**:
- [ ] Interest Label順に優先順位付けできる（ACT_NOW > THINK > FYI > IGNORE）
- [ ] 同一ラベル内ではBuzz Label、鮮度、Confidenceでソートできる
- [ ] 最大12件を選定できる
- [ ] 同一ドメイン偏り制御（同一ドメインは最大4件まで、推奨）ができる
- [ ] 0件の場合も通知する（「今回は該当なし」のメッセージ）

**優先度**: P0(必須)

#### 8. 通知

**ユーザーストーリー**:
ユーザーとして、厳選された記事一覧をメールで受け取りたい

**受け入れ条件**:
- [ ] メール本文に記事一覧（タイトル、URL、Interest/Buzzラベル、理由）を含める
- [ ] サマリ統計（収集数、LLM判定数、最終通知数、実行日時）を含める
- [ ] 0件の場合も通知する
- [ ] SES経由で送信できる

**優先度**: P0(必須)

**メールフォーマット例**:
```
件名: [AI Curated Newsletter] 2025-01-15 - 8件の記事

========================================
AI Curated Newsletter - 2025-01-15
========================================

今回の通知: 8件
収集数: 342件
LLM判定数: 120件
実行日時: 2025-01-15 09:00 UTC

========================================
ACT_NOW (2件)
========================================

1. [タイトル]
   URL: https://...
   Buzz: HIGH
   理由: PostgreSQLのインデックス戦略について実践的な知見

2. ...

========================================
THINK (4件)
========================================

...

========================================
FYI (2件)
========================================

...
```

#### 9. 実行履歴保存

**ユーザーストーリー**:
システム管理者として、実行履歴を保存し、トラブルシューティングやコスト分析に使用したい

**受け入れ条件**:
- [ ] DynamoDBに実行履歴を保存できる（PK: `RUN#yyyyww`, SK: `SUMMARY#timestamp`）
- [ ] 保存内容: 収集数、LLM判定数、最終通知数、送信結果、コスト概算、実行時間
- [ ] run_id単位で構造化ログを出力できる

**優先度**: P0(必須)

#### 10. EventBridge定期実行

**ユーザーストーリー**:
ユーザーとして、週2〜3回自動的にキュレーション通知を受け取りたい

**受け入れ条件**:
- [ ] EventBridgeで週2〜3回のスケジュール実行を設定できる
- [ ] 曜日・時間は設定可能（例: 火曜09:00 UTC、金曜09:00 UTC）
- [ ] 手動実行も可能（Lambda直接実行、dry_runモードあり）

**優先度**: P0(必須)

### 将来的な機能(Post-MVP - Phase 2)

#### フィードバック機能

ユーザーが通知記事に対して「良かった / 普通 / 不要だった」のフィードバックを送信し、判定精度の測定・改善に活用する

**優先度**: P1(重要)

#### 近似重複排除

完全一致だけでなく、内容が類似する記事（同一トピックの別ソース記事）を検出・排除する

**優先度**: P2(できれば)

#### ソース追加（GitHub Trending、Reddit、HackerNews API）

RSS以外の情報源を追加し、カバレッジを拡大する

**優先度**: P1(重要)

#### ドメイン偏り制御強化

同一ドメインの記事が多すぎる場合、より高度な分散ロジックを適用する

**優先度**: P2(できれば)

## 非機能要件

### パフォーマンス
- **Lambda実行時間**: 15分以内（タイムアウト）
- **LLM判定並列度**: 5件同時処理
- **全体スループット**: 120件のLLM判定を5分以内に完了

### ユーザビリティ
- **メール可読性**: モバイルでも読みやすいプレーンテキスト形式
- **設定変更**: 関心プロファイル更新はコード変更不要（設定ファイル or DynamoDB管理）

### 信頼性
- **冪等性保証**: 同一run_idでの再実行時、重複通知しない
- **部分失敗許容**: 1つのソース失敗で全体が停止しない
- **データ損失防止**: DynamoDBキャッシュは永続化（TTLなし、または十分に長い）

### セキュリティ
- **認証情報管理**: AWS Secrets Managerで管理（ハードコード禁止）
- **最小権限原則**: Lambdaロールは必要最小限の権限のみ付与
- **ログマスキング**: 個人情報（メールアドレス）はログに出力しない

### スケーラビリティ
- **記事数増加対応**: 収集件数が1000件になっても15分以内に処理完了
- **LLM判定数上限**: 150件を超える場合はBuzzスコアで厳選
- **DynamoDB容量**: オンデマンドモードで自動スケール

### コスト
- **LLMコスト**: 1回あたり$0.50以下（週2回で月$4以下）
- **DynamoDBコスト**: 月$5以下（オンデマンドモード）
- **Lambdaコスト**: 月$1以下（実行時間・メモリ最適化）
- **総コスト**: 月$10以下

### 可観測性
- **構造化ログ**: JSON形式、run_id単位で追跡可能
- **CloudWatch Logs**: 30日間保存
- **メトリクス**: 収集数、LLM判定数、最終通知数、実行時間、エラー数をCloudWatchに送信
- **アラート**: 実行失敗時にSNS通知（Phase 2）

## 制約事項

### 絶対制約（変更不可）
- **出力最小主義**: 通知件数を増やす方向の改善は禁止
- **LLM限定使用**: LLMは判定のみに使用。件数制御・重複排除・Buzz定量は非LLMロジック
- **本文全文禁止**: 記事本文全文の取得・保存・LLM投入は禁止（コスト・精度の観点）
- **再判定禁止**: 同一URLは一度判定したらキャッシュし、再判定しない
- **単一責務原則**: 各コンポーネントは1つの変更理由のみを持つ
- **個人開発の原則**: TooMuchにならないこと（複雑さ・コスト・運用負荷を最小限に保つ）

### アーキテクチャ制約
- **技術スタック**: AWS Lambda（Python 3.12）、DynamoDB、Bedrock、SES、EventBridge
- **実行頻度**: 週2〜3回（EventBridge）
- **LLM判定対象**: 最大150件（推奨120件）
- **通知上限**: 各回最大12件

## スコープ外

明示的にスコープ外とする項目:
- **リアルタイム通知**: 週2〜3回のバッチ処理のみ
- **無制限通知**: 各回最大12件を厳守
- **SNS全量解析**: RSS/Atomのみ（Phase 1）
- **自動学習によるレコメンド最適化**: 関心プロファイルは手動管理
- **本文全文の取得・保存・LLM投入**: 概要のみ使用
- **通知件数を増やす方向の改善**: 出力最小主義を維持
- **マルチユーザー対応**: 単一ユーザー（本人）のみ
- **Webインターフェース**: メール通知のみ
- **記事の保存・アーカイブ**: 通知のみ、保存機能なし
