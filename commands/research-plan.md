---
description: 技術調査からGitHub issue作成、計画、実装まで段階的に進める
argument-hint: 調査テーマ
---

# 技術調査から実装まで (/research-plan)

**目的:** 技術調査 → GitHub issue作成 → 計画 → 実装という一連のフローを対話的に進める

**引数:** 調査テーマ（必須）

**例:**
- `/research-plan パフォーマンス改善の方法を調査`
- `/research-plan 既存のエラーハンドリングパターン`
- `/research-plan LLMのコスト削減手法`

**フロー:**
1. 調査実行（自動）→ 結果報告
2. 確認 → GitHub issue作成
3. 確認 → `/spec-plan`実行
4. 確認 → `/implement` 実行

---

## ステップ1: 調査フェーズ（自動実行）

1. **調査テーマを解析:**
   - 引数から調査すべきキーワードを特定
   - 関連するファイルパターンを推測

2. **Task ツールで Explore agent を実行:**
   ```
   Task(
     subagent_type='Explore',
     prompt='[調査テーマ] について、コードベース内を調査してください。

     調査観点:
     - 既存の実装パターン
     - 関連する設定やドキュメント
     - 改善可能な箇所
     - ベストプラクティスとの比較

     thoroughness: medium'
   )
   ```

3. **調査結果を整理してユーザーに報告:**
   ```markdown
   ## 調査結果: [調査テーマ]

   ### 発見事項
   - [主要な発見事項をリストアップ]

   ### 既存実装
   - [関連するファイルとその内容の要約]

   ### 改善提案
   - [具体的な改善案や検討事項]

   ### 次のステップの提案
   - [GitHub issueとして記録すべき項目]
   ```

4. **ユーザーに確認:**
   - 「この調査結果をもとに GitHub issue を作成しますか？」

## ステップ2: GitHub Issue 作成フェーズ

**前提:** ステップ1でユーザーが承認した場合のみ実行

1. **issue タイトルと本文を生成:**
   - タイトル: 調査結果を踏まえた具体的なタスク名
     - 日本語、動詞で終わる形式 (例: "LLMコストを削減")
   - 本文:
     ```markdown
     ## 背景
     [調査テーマと調査のきっかけ]

     ## 調査結果の要約
     [ステップ1の調査結果から重要な点を抽出]

     ## 実施内容
     - [ ] [具体的なタスク1]
     - [ ] [具体的なタスク2]

     ## 参考
     - [関連ファイルや外部リソースへのリンク]
     ```

2. **ラベルを推定:**
   - 調査内容から適切なラベルを推定 (例: enhancement, bug, documentation)

3. **GitHub issue を作成:**
   ```bash
   gh issue create \
     --title "[タイトル]" \
     --body "[本文]" \
     --label "[ラベル]"
   ```

4. **作成された issue URL を取得・表示**

5. **ユーザーに確認:**
   - 「この issue をもとに計画フェーズ (/plan) を実行しますか？」

## ステップ3: 計画フェーズ

**前提:** ステップ2でユーザーが承認した場合のみ実行

1. **`/spec-plan`コマンドを実行:**
   - ステップ2で作成した issue URL を引数として渡す
   ```
   /plan [issue URL]
   ```

2. **`/spec-plan`は以下を実行:**
   - issue 内容を取得
   - プロジェクト理解と既存パターン調査
   - ステアリングファイル (requirements.md, design.md, tasklist.md) を生成

3. **ステアリングディレクトリパスを取得:**
   - `/spec-plan`が作成したステアリングディレクトリのパス
   - パターン: `.steering/[日付]-[機能名]/`

4. **ユーザーに確認:**
   - 「計画が完了しました。実装フェーズ (/implement) を実行しますか？」

## ステップ4: 実装フェーズ

**前提:** ステップ3でユーザーが承認した場合のみ実行

1. **`/implement` コマンドを実行:**
   - ステップ3で取得したステアリングディレクトリパスを引数として渡す
   ```
   /implement [ステアリングディレクトリパス]
   ```

2. **`/implement` は以下を実行:**
   - TDD サイクル (RED → GREEN → REFACTOR) で実装
   - 実装検証 (implementation-validator サブエージェント)
   - 自動テスト実行 (pytest, ruff, mypy)
   - 振り返りとドキュメント更新

3. **完了メッセージを表示**

---

## 完了条件

このワークフローは、以下のいずれかで完了となる:
- **途中中断**: 各確認ステップでユーザーが「いいえ」を選択した場合
- **全体完了**: ステップ4の `/implement` が正常に完了した場合

---

## 注意事項

- このコマンドは各フェーズでユーザーの確認を求める対話的なワークフロー
- 調査フェーズ（ステップ1）のみ自動実行され、それ以降は各フェーズで確認が入る
- GitHub issue作成以降は既存の `/spec-plan`と `/implement` を再利用する
- 途中で中断した場合、作成済みの成果物（issue、ステアリングファイル等）は保持される

## 使い分け

- **`/research-plan`**: 技術調査から始めて、段階的に実装まで進めたい場合 (このコマンド)
- **`/plan`**: 要件が明確で、計画から始めたい場合
- **`/add-feature`**: 要件が明確で、計画から実装まで一気に完了させたい場合
- **`/implement`**: 既にステアリングファイルがあり、実装だけを行いたい場合
