# 要求内容

## GitHub Issue
https://github.com/k-negishi/ai-curated-newsletter/issues/12

## issue 内容
- タイトル: メールの体裁整える
- 本文: なし
- ラベル: なし

## 実装方針
- Kent Beck の TDD (Test-Driven Development) で実装する
- RED → GREEN → REFACTOR のサイクルを遵守する
- テストを先に書き、最小限の実装でパスさせ、その後リファクタリングする

## 関連コメント（要求の実体）
https://github.com/k-negishi/ai-curated-newsletter/issues/12#issuecomment-3898690846

1. 区切り線 `================================================================================` はスマホ閲覧で長すぎるため短縮する
2. 日時は UTC 表示をやめ、JST 基準で表示する（`JST` の文言は付けない）
3. 件名は `Techニュースレター - YYYY年M月D日` 形式（可変日付）
4. 記事番号 `[1]` はセクションごとにリセットせず、メール全体で通番
5. ハイパーリンクは URL のみを対象にし、`.io` など本文中の非 URL 文字列がリンク化されないようにする
6. `概要` の下に `Tag` 行を追加（例: `Kotlin`, `Claude`）

## 背景と現状
- 現行の `src/services/formatter.py` は 80 文字区切り線、UTC 表記、セクション単位の連番を採用している
- 件名は `src/orchestrator/orchestrator.py` で `AI Curated Newsletter - YYYY-MM-DD` 形式
- 現行データモデル (`JudgmentResult`) に `Tag` 表示用の専用フィールドがない
- 通知は `Notifier` でテキスト本文（SES `Body.Text`）として送信している

## 目的
- モバイルで読みやすい文面に調整し、ユーザー指定の見た目に合わせる
- 日付/時刻の認知負荷を下げる（国内利用想定の JST 表示）
- 記事の把握性を高める（通番維持・Tag 追加）

## 機能要件

### FR-1 区切り線の短縮
- ヘッダー/セクション/フッター/記事区切りのライン長をスマホ閲覧に適した長さへ変更する
- 受け入れ条件:
  - [ ] 80 文字固定の罫線が残っていない
  - [ ] 画面幅が狭い端末でも横スクロールを誘発しない

### FR-2 日時の JST 表示
- メール本文の実行日時は JST 換算で表示する
- 表示文字列に `UTC` / `JST` などのタイムゾーン表記は付与しない
- 受け入れ条件:
  - [ ] 実行日時が UTC ではなく JST の時計で出力される
  - [ ] タイムゾーンの接尾辞がない

### FR-3 件名フォーマット変更
- 件名を `Techニュースレター - YYYY年M月D日` に変更する
- 受け入れ条件:
  - [ ] 送信件名が指定フォーマットに一致する
  - [ ] 日付は実行日の可変値になる

### FR-4 記事番号の通番化
- `[n]` は ACT_NOW / THINK / FYI をまたいで増加し続ける
- 受け入れ条件:
  - [ ] セクション切替後も番号が 1 に戻らない
  - [ ] 掲載順どおりに 1..N が連続する

### FR-5 リンク化制御
- ユーザーが明示的に意図した URL のみをリンク対象にする
- 受け入れ条件:
  - [ ] URL 行以外の本文（タイトル、概要、Tag など）で意図しないリンク化を抑制できる実装方針になっている
  - [ ] 少なくとも `.io` 等のドメイン断片で誤リンクが起きにくい

### FR-6 Tag 行の追加
- 各記事ブロックで `概要` の直下に `Tag` 行を追加する
- 受け入れ条件:
  - [ ] `Tag: ...` が各記事に表示される
  - [ ] 複数タグを扱える（カンマ区切り等）

## 非機能要件・制約
- 既存の通知フロー（収集→判定→選定→通知）を壊さない
- 0 件通知時の動作は現行仕様を維持する
- 変更後も既存テスト群および新規追加テストで検証可能な設計にする

## 要確認事項（実装前に確定）
1. **リンク化制御の実現手段**
   - プレーンテキスト継続ではメールクライアント側の自動リンク化を完全制御できないため、HTML メール併用（Text+Html）にするか確認が必要
2. **Tag の生成元**
   - LLM 出力として保持するか、既存テキスト（title/description）から抽出するかを確定する必要がある

## スコープ外
- 記事選定ロジック（Interest/Buzz 判定基準）の変更
- 配信頻度や配信トリガー（EventBridge 等）の変更
